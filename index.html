<!DOCTYPE HTML>
<html>
  <head>
      <link href="https://fonts.googleapis.com/css?family=Anton|Cabin|Nobile|Sarabun|Yrsa&display=swap" rel="stylesheet">
    <style>

      html {
        max-width: 1000px;
        margin: 0 auto;
        background-color:rgba(127,255,212,0.3);
      }

      body {
        width: 100%;
        margin: 0px;
        padding: 0px;
      }

      h3, h5, p {
        font-family: Verdana, Geneva, Tahoma, sans-serif;
      }

      #magic-pong-header {
        font-family: 'Anton', sans-serif;
        font-size: 30px;
      }

      .modal {
          display: none;
          position: fixed;
          background-color: rgba(0,0,0,0.4);
          padding-top: 100px;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          z-index: 1;
      }

      .modal-content {
        text-align: center;
        background-color: #f0efe5;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
       }

       button {
         width: 10%;
         padding: 3% 0;
         font-family: Verdana, Geneva, Tahoma, sans-serif;
         font-size: 16px;
         background-color: aquamarine;
       }

       button:hover {
         cursor: pointer;
       }

    </style>
  </head>
  <body>
    <div style="width: inherit;">
      <div style="display:inline-block; width: 16%; margin: 0 9% 0 1%;">
        <div style="display:inline-block;"><p>Computer Score:</p></div>
        <div style="display:inline-block;" id="computerSide"></div>
      </div>
      <div style="display:inline-block; margin-left: 0 7%;">
        <h3 style="visibility: hidden; display:inline-block;" id="winMessage">You won!</h3>
        <h3 style="visibility: hidden; display:inline-block; padding-left: 10px; color:blue;" id="restartMessage">Refresh your browser to play again.</h3>
      </div>
      <div style="display:inline-block; width: 13%; margin-left: 9%">
        <div style="display:inline-block;"><p>Player Score:</p></div>
        <div style="display:inline-block;" id="playerSide"></div>
      </div>
    </div>
    <canvas id="myCanvas" width="1000" height="610" style="border-style:solid #fff; background-color:black; margin-top:5px; display:block;"></canvas>

    <div id="modalArea" class="modal">
      <div class="modal-content">
        <h2 id="magic-pong-header">Welcome to Magic Pong!</h2>
        <p>
        A modern take on the Classic Pong game, the rules are simple.<br />
        You are in control of the right paddle. Simply press down on the up and down keys to move your paddle
        and prevent the Computer paddle from scoring. Reach a score of 10 first to win the game. 
        </p>
        <h5>Click the <strong>Start Button</strong> to start the game.</h5>
        <button id="startGame">Start</button>
      </div>
    </div>
    <script>

    var startBtn = document.getElementById("startGame");
    var canvas = document.getElementById('myCanvas');
    let playerScore = 0;
    let computerScore = 0;

    var modal = document.getElementById("modalArea");

    var openModal = document.getElementById("myBtn");

    var startBtn = document.getElementById("startGame");

    class Paddle {
      constructor(x, y, width, height, speed) {
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.speed = 50;
        this.vx = 5;
        this.vy = 2;
      }
    }

    class Player extends Paddle {
      constructor(x, y, width, height) {
        super(x, y, width, height);
        this.name = "Player";
      }
    }

    class Computer extends Paddle {
      constructor(x, y, width, height) {
        super(x, y, width, height);
        this.name = "Computer";
      }
    }

    class Ball {
      constructor(radius, startAngle, endAngle) {
        this.radius = radius;
        this.startAngle = startAngle;
        this.endAngle = endAngle;
        this.x = 500;
        this.y = 305;
        this.vx = 5;
        this.vy = -2;
      }
    }

    Paddle.prototype.move = function move(speed) {
      this.speed = speed;
      this.y += this.speed;
    }

    Player.prototype.render = function render() {
      var playerCanvas = document.getElementById("myCanvas");
      var playerContext = playerCanvas.getContext('2d');
      playerContext.fillStyle = "#fff";
      playerContext.fillRect(this.x, this.y, this.width, this.height);
      playerContext.closePath();
    }

    Computer.prototype.render = function render() {
      var computerCanvas = document.getElementById("myCanvas");
      var computerContext = computerCanvas.getContext('2d');
      computerContext.fillStyle = "#fff";
      computerContext.fillRect(this.x, this.y, this.width, this.height);
      computerContext.closePath();
    }

    Computer.prototype.update = function update(ball) {
      ball.x += ball.vx;
      ball.y += ball.vy;
      var left_x = ball.x - 50;
      var right_x = ball.x + 50;
      var top_y = ball.y - 50;
      var bottom_y = ball.y + 50;

      if (bottom_y < canvas.height/2 && left_x > this.x + this.width && right_x < canvas.width/2) {
        if (this.y > 0) {
          this.move(-5);
        } else if ((this.y + this.height)/2 <= 305) {
          this.move(5);
        }
      } else if (bottom_y > canvas.height/2 && left_x > this.x + this.width && right_x < canvas.width/2) {
        if ((this.y + this.height)/2 > 305) {
          this.move(-5);
        } else if (this.y < 460) {
          this.move(5);
        }
      }
    }

    Ball.prototype.render = function render() {
      var ballCanvas = document.getElementById("myCanvas");
      var ballContext = ballCanvas.getContext('2d');
      ballContext.beginPath();
      ballContext.arc(this.x, this.y, this.radius, this.startAngle, this.endAngle);
      ballContext.fillStyle = "#fff";
      ballContext.fill();
      ballContext.closePath();
    }

    Ball.prototype.update = function update() {
      this.x += this.vx;
      this.y += this.vy;
    }

    Ball.prototype.stop = function stop() {
      this.vx = 0;
      this.vy = 0;
    }

    Ball.prototype.move = function move() {
      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, 1000, 610);
      render();

      var playerScoreTotal = document.getElementById('playerSide');
      playerScoreTotal.innerHTML = playerScore;
      var computerScoreTotal = document.getElementById('computerSide');
      computerScoreTotal.innerHTML = computerScore;

      var winMessage = document.getElementById('winMessage');
      var restartMessage = document.getElementById('restartMessage');

      var num = Math.floor(Math.random()*7) + 1;
      num *= Math.floor(Math.random()*2) == 1 ? 1 : -1;

      if (this.y + this.vy > (canvas.height - 35) ||
          this.y + this.vy < 35) {
            this.vy = -this.vy;
      }
     
      if (playerScore === 10 ) {
        this.stop();
        winMessage.style.visibility = "visible";
        restartMessage.style.visibility = "visible";
        playerScore = 0;
        playerScoreTotal.innerHTML = playerScore;
        computerScore = 0;
        computerScoreTotal.innerHTML = computerScore;
      } else if (computerScore === 10) {
        this.stop();
        winMessage.innerHTML = "You lost...";
        winMessage.style.visibility = "visible";
        restartMessage.style.visibility = "visible";
        playerScore = 0;
        playerScoreTotal.innerHTML = playerScore;
        computerScore = 0;
        computerScoreTotal.innerHTML = computerScore;
      }

      if (this.x + this.vx > canvas.width) {
        computerScore += 1;
        computerScoreTotal.innerHTML = computerScore;
        this.x = 500;
        this.y = 305;
        this.vx = num;
        this.vy = num;
      } else if (this.x + this.vx < 0) {
        playerScore += 1;
        playerScoreTotal.innerHTML = playerScore;
          this.x = 500;
          this.y = 305;
          this.vx = num;
          this.vy = num;
        }
    }

    function collision(ball, player, computer) {
      ball.x += ball.vx;
      ball.y += ball.vy;
      var left_x = ball.x - 25;
      var right_x = ball.x + 25;
      var top_y = ball.y - 25;
      var bottom_y = ball.y + 25;

      if (ball.vx > 0) {
        if (left_x < (player.x + player.width) && right_x > player.x && top_y < (player.y + player.height) && bottom_y > player.y) {
          ball.vx = -ball.vx;
          ball.vy += (player.vy / 2);
          ball.x += ball.vx;
        }
      } else {
        if (left_x < (computer.x + computer.width) && right_x > computer.x && top_y < (computer.y + computer.height) && bottom_y > computer.y) {
          ball.vx = -ball.vx;
          ball.vy += (computer.vy / 2);
          ball.x += ball.vx;
        }
      }
    }

    var player = new Player(930, 25, 20, 150);
    var computer = new Computer(50, 25, 20, 150)
    var ball = new Ball(25, 0, 2 * Math.PI);

    const render = () => {
      player.render();
      computer.render();
      ball.render();
    }

    function startGameBox() {
      render();
      var startGame = window.setTimeout( start, 1*1000, 'Click below to start game.');
    }

    var start = function() {
      modal.style.display = "block";
    }

    startBtn.onclick = function() {
      modal.style.display = "none";
      animate(step);
    }

    var animate = window.requestAnimationFrame ||
        function(callback) { window.setTimeout(callback, 1000/60) };

    function step(timestamp) {
      animate(step);
      ball.update();
      ball.move();
      collision(ball, player, computer);
      computer.update(ball);
    }

    window.addEventListener('keydown', function(event) {
     const keyName = event.key;
     ctx = document.getElementById("myCanvas").getContext('2d');
     ctx.clearRect(0, 0, 1000, 610);
     if (keyName === "ArrowDown") {
       if (player.y < 460) {
         player.move(20);
       }
     } else if (keyName === "ArrowUp") {
       if (player.y > 0) {
         player.move(-20);
       }
     }
    });

    window.onload = startGameBox;

    </script>
  </body>
</html>
